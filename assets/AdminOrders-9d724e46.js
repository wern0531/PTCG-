import{M as g}from"./bootstrap.esm-1bc60e5a.js";import{P as C}from"./PaginationView-d49a6ef2.js";import{_ as D,c as o,e as y,w as L,b as t,F as _,j as u,t as l,q as P,u as f,y as k,l as O,r as v,o as d}from"./index-8fd826e5.js";import{_ as E}from"./pikachu_gif-e9cb6898.js";const{VITE_URL:p,VITE_PATH:m}={VITE_URL:"https://vue3-course-api.hexschool.io/",VITE_PATH:"wern",BASE_URL:"/production-sub-path/",MODE:"production",DEV:!1,PROD:!0};let x="",b="";const V={data(){return{isLoading:!1,orders:[],pagination:{},tempOrder:{}}},methods:{createDate(n){return new Date(n*1e3).toLocaleDateString()},currency(n){return`${parseInt(n,10).toFixed(0).replace(/./g,(c,h,e)=>h&&c!=="."&&(e.length-h)%3===0?`, ${c}`.replace(/\s/g,""):c)}`},getOrders(n=1){this.$http.get(`${p}v2/api/${m}/admin/orders?page=${n}`).then(a=>{this.orders=a.data.orders,this.pagination=a.data.pagination,this.isLoading=!1})},updatePaid(n){const a={is_paid:n.is_paid};this.$http.put(`${p}v2/api/${m}/admin/order/${n.id}`,{data:a}).then(c=>{console.log(c)})},openModel(n,a){n==="edit"?(this.tempOrder={...a},x.show()):n==="del"&&(this.tempOrder={...a},b.show())},delOrder(){this.$http.delete(`${p}v2/api/${m}/admin/order/${this.tempOrder.id}`).then(n=>{this.tempOrder={},this.getOrders(),b.hide(),alert(n.data.message)})}},components:{Pagination:C},mounted(){this.isLoading=!0,this.getOrders(),x=new g(this.$refs.orderModal,{keyboard:!1}),b=new g(this.$refs.delOrderModal,{keyboard:!1})}},T=t("div",{class:"loadingGif"},[t("img",{src:E,alt:"會動的皮卡丘過場圖"})],-1),I={class:"container"},U={class:"table mt-4 text-white"},S=t("thead",null,[t("tr",null,[t("th",{width:"120"},"購買時間"),t("th",{width:"120"},"Email"),t("th",{width:"200"},"購買款項"),t("th",{width:"120"},"應付金額"),t("th",{width:"100"},"是否付款"),t("th",{width:"120"},"編輯")])],-1),A={class:""},B={class:"list-unstyled"},N={class:""},R={class:"form-check form-switch"},q=["onUpdate:modelValue","onChange"],F={class:"form-check-label",for:"flexSwitchCheckDefault"},j={key:0,class:"text-success"},H={key:1},z={class:"btn-group"},G=["onClick"],J=["onClick"],K={class:"modal fade",id:"orderModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"orderModal"},Q={class:"modal-dialog modal-xl",role:"document"},W={class:"modal-content border-0"},X=t("div",{class:"modal-header bg-dark text-white"},[t("h5",{class:"modal-title",id:"exampleModalLabel"},[t("span",null,"訂單細節")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Y={class:"modal-body"},Z={class:"row"},$={class:"col-md-4"},tt=t("h3",null,"用戶資料",-1),et={class:"table"},st={key:0},lt=t("th",{style:{width:"100px"}},"姓名",-1),ot=t("th",null,"Email",-1),dt=t("th",null,"電話",-1),nt=t("th",null,"地址",-1),at={class:"col-md-8"},it=t("h3",null,"訂單細節",-1),rt={class:"table"},ct=t("th",{style:{width:"100px"}},"訂單編號",-1),_t=t("th",null,"下單時間",-1),ht=t("th",null,"付款時間",-1),ut={key:0},pt={key:1},mt=t("th",null,"付款狀態",-1),bt={key:0,class:"text-success"},gt={key:1,class:"text-muted"},yt=t("th",null,"總金額",-1),ft=t("h3",null,"選購商品",-1),kt={class:"table"},Ot=t("thead",null,[t("tr")],-1),vt={class:"text-end"},xt={class:"d-flex justify-content-end"},wt={class:"form-check"},Mt={class:"form-check-label",for:"flexCheckDefault"},Ct={key:0},Dt={key:1},Lt=t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 "),t("button",{type:"button",class:"btn btn-primary"},"修改付款狀態")],-1),Pt={id:"delOrderModal",ref:"delOrderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},Et={class:"modal-dialog"},Vt={class:"modal-content border-0"},Tt=t("div",{class:"modal-header bg-danger text-white"},[t("h5",{id:"delProductModalLabel",class:"modal-title"},[t("span",null,"刪除訂單")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),It={class:"modal-body"},Ut={class:"text-danger"},St={class:"modal-footer"},At=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Bt(n,a,c,h,e,i){const w=v("LoadingItem"),M=v("Pagination");return d(),o(_,null,[y(w,{active:e.isLoading,"z-index":1060},{default:L(()=>[T]),_:1},8,["active"]),t("div",I,[t("table",U,[S,t("tbody",null,[(d(!0),o(_,null,u(e.orders,s=>(d(),o("tr",{key:s.id},[t("td",null,l(i.createDate(s.create_at)),1),t("td",null,l(s.user.email),1),t("td",A,[t("ul",B,[(d(!0),o(_,null,u(s.products,r=>(d(),o("li",{key:r.id},l(r.product.title)+" 數量 : "+l(r.qty)+l(r.product.unit),1))),128))])]),t("td",N,l(s.total),1),t("td",null,[t("div",R,[f(t("input",{class:"form-check-input",type:"checkbox",id:"flexSwitchCheckDefault","onUpdate:modelValue":r=>s.is_paid=r,onChange:r=>i.updatePaid(s)},null,40,q),[[k,s.is_paid]]),t("label",F,[s.is_paid===!0?(d(),o("span",j,"已付款")):(d(),o("span",H,"未付款"))])])]),t("td",null,[t("div",z,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:r=>i.openModel("edit",s)}," 檢視 ",8,G),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:r=>i.openModel("del",s)}," 刪除 ",8,J)])])]))),128))])]),y(M,{pages:e.pagination,onEmitPages:i.getOrders},null,8,["pages","onEmitPages"])]),t("div",K,[t("div",Q,[t("div",W,[X,t("div",Y,[t("div",Z,[t("div",$,[tt,t("table",et,[e.tempOrder.user?(d(),o("tbody",st,[t("tr",null,[lt,t("td",null,l(e.tempOrder.user.name),1)]),t("tr",null,[ot,t("td",null,l(e.tempOrder.user.email),1)]),t("tr",null,[dt,t("td",null,l(e.tempOrder.user.tel),1)]),t("tr",null,[nt,t("td",null,l(e.tempOrder.user.address),1)])])):P("",!0)])]),t("div",at,[it,t("table",rt,[t("tbody",null,[t("tr",null,[ct,t("td",null,l(e.tempOrder.id),1)]),t("tr",null,[_t,t("td",null,l(i.createDate(e.tempOrder.create_at)),1)]),t("tr",null,[ht,t("td",null,[e.tempOrder.paid_date?(d(),o("span",ut,l(i.createDate(e.tempOrder.paid_date)),1)):(d(),o("span",pt,"時間不正確"))])]),t("tr",null,[mt,t("td",null,[e.tempOrder.is_paid?(d(),o("strong",bt,"已付款")):(d(),o("span",gt,"尚未付款"))])]),t("tr",null,[yt,t("td",null,l(i.currency(e.tempOrder.total)),1)])])]),ft,t("table",kt,[Ot,t("tbody",null,[(d(!0),o(_,null,u(e.tempOrder.products,s=>(d(),o("tr",{key:s.id},[t("th",null,l(s.product.title),1),t("td",null,l(s.qty)+" / "+l(s.product.unit),1),t("td",vt,l(i.currency(s.final_total)),1)]))),128))])]),t("div",xt,[t("div",wt,[f(t("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":a[0]||(a[0]=s=>e.tempOrder.is_paid=s)},null,512),[[k,e.tempOrder.is_paid]]),t("label",Mt,[e.tempOrder.is_paid?(d(),o("span",Ct,"已付款")):(d(),o("span",Dt,"未付款"))])])])])])]),Lt])])],512),t("div",Pt,[t("div",Et,[t("div",Vt,[Tt,t("div",It,[O(" 是否刪除訂單編號 "),t("strong",Ut,l(e.tempOrder.id),1),O(" (刪除後將無法恢復)。 ")]),t("div",St,[At,t("button",{type:"button",class:"btn btn-danger",onClick:a[1]||(a[1]=(...s)=>i.delOrder&&i.delOrder(...s))}," 確認刪除 ")])])])],512)],64)}const jt=D(V,[["render",Bt]]);export{jt as default};
