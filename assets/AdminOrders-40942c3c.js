import{M as f}from"./bootstrap.esm-a19cc5f0.js";import{P as C}from"./PaginationComponent-95e66840.js";import{_ as D,c as o,e as g,w as L,b as t,F as _,l as u,t as l,s as P,v as y,y as k,f as v,r as O,o as d}from"./index-7ba7e1c6.js";import{_ as E}from"./pikachu_gif-ecacffd9.js";const{VITE_URL:p,VITE_PATH:m}={VITE_URL:"https://vue3-course-api.hexschool.io/",VITE_PATH:"wern",BASE_URL:"/PTCGTrainerWeb/",MODE:"production",DEV:!1,PROD:!0};let x="",b="";const V={data(){return{isLoading:!1,orders:[],pagination:{},tempOrder:{}}},methods:{createDate(n){return new Date(n*1e3).toLocaleDateString()},currency(n){return`${parseInt(n,10).toFixed(0).replace(/./g,(c,h,e)=>h&&c!=="."&&(e.length-h)%3===0?`, ${c}`.replace(/\s/g,""):c)}`},getOrders(n=1){this.$http.get(`${p}v2/api/${m}/admin/orders?page=${n}`).then(a=>{this.orders=a.data.orders,this.pagination=a.data.pagination,this.isLoading=!1})},updatePaid(n){const a={is_paid:n.is_paid};this.$http.put(`${p}v2/api/${m}/admin/order/${n.id}`,{data:a}).then(c=>{console.log(c)})},openModel(n,a){n==="edit"?(this.tempOrder={...a},x.show()):n==="del"&&(this.tempOrder={...a},b.show())},delOrder(){this.$http.delete(`${p}v2/api/${m}/admin/order/${this.tempOrder.id}`).then(n=>{this.tempOrder={},this.getOrders(),b.hide(),alert(n.data.message)})}},components:{Pagination:C},mounted(){this.isLoading=!0,this.getOrders(),x=new f(this.$refs.orderModal,{keyboard:!1}),b=new f(this.$refs.delOrderModal,{keyboard:!1})}},T=t("div",{class:"loadingGif"},[t("img",{src:E,alt:"會動的皮卡丘過場圖"})],-1),I={class:"container"},U={class:"table mt-4 text-white"},S=t("thead",null,[t("tr",null,[t("th",{width:"120"},"購買時間"),t("th",{width:"120"},"Email"),t("th",{width:"200"},"購買款項"),t("th",{width:"120"},"應付金額"),t("th",{width:"100"},"是否付款"),t("th",{width:"120"},"編輯")])],-1),A={class:"list-unstyled"},B={class:"form-check form-switch"},N=["onUpdate:modelValue","onChange"],R={class:"form-check-label",for:"flexSwitchCheckDefault"},F={key:0,class:"text-success"},q={key:1},G={class:"btn-group"},H=["onClick"],j=["onClick"],z={class:"modal fade",id:"orderModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"orderModal"},W={class:"modal-dialog modal-xl",role:"document"},J={class:"modal-content border-0"},K=t("div",{class:"modal-header bg-dark text-white"},[t("h5",{class:"modal-title",id:"exampleModalLabel"},[t("span",null,"訂單細節")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Q={class:"modal-body"},X={class:"row"},Y={class:"col-md-4"},Z=t("h3",null,"用戶資料",-1),$={class:"table"},tt={key:0},et=t("th",{style:{width:"100px"}},"姓名",-1),st=t("th",null,"Email",-1),lt=t("th",null,"電話",-1),ot=t("th",null,"地址",-1),dt={class:"col-md-8"},nt=t("h3",null,"訂單細節",-1),at={class:"table"},it=t("th",{style:{width:"100px"}},"訂單編號",-1),rt=t("th",null,"下單時間",-1),ct=t("th",null,"付款時間",-1),_t={key:0},ht={key:1},ut=t("th",null,"付款狀態",-1),pt={key:0,class:"text-success"},mt={key:1,class:"text-muted"},bt=t("th",null,"總金額",-1),ft=t("h3",null,"選購商品",-1),gt={class:"table"},yt=t("thead",null,[t("tr")],-1),kt={class:"text-end"},vt={class:"d-flex justify-content-end"},Ot={class:"form-check"},xt={class:"form-check-label",for:"flexCheckDefault"},wt={key:0},Mt={key:1},Ct=t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 "),t("button",{type:"button",class:"btn btn-primary"},"修改付款狀態")],-1),Dt={id:"delOrderModal",ref:"delOrderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},Lt={class:"modal-dialog"},Pt={class:"modal-content border-0"},Et=t("div",{class:"modal-header bg-danger text-white"},[t("h5",{id:"delProductModalLabel",class:"modal-title"},[t("span",null,"刪除訂單")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Vt={class:"modal-body"},Tt={class:"text-danger"},It={class:"modal-footer"},Ut=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function St(n,a,c,h,e,i){const w=O("LoadingItem"),M=O("Pagination");return d(),o(_,null,[g(w,{active:e.isLoading,"z-index":1060},{default:L(()=>[T]),_:1},8,["active"]),t("div",I,[t("table",U,[S,t("tbody",null,[(d(!0),o(_,null,u(e.orders,s=>(d(),o("tr",{key:s.id},[t("td",null,l(i.createDate(s.create_at)),1),t("td",null,l(s.user.email),1),t("td",null,[t("ul",A,[(d(!0),o(_,null,u(s.products,r=>(d(),o("li",{key:r.id},l(r.product.title)+" 數量 : "+l(r.qty)+l(r.product.unit),1))),128))])]),t("td",null,l(s.total),1),t("td",null,[t("div",B,[y(t("input",{class:"form-check-input",type:"checkbox",id:"flexSwitchCheckDefault","onUpdate:modelValue":r=>s.is_paid=r,onChange:r=>i.updatePaid(s)},null,40,N),[[k,s.is_paid]]),t("label",R,[s.is_paid===!0?(d(),o("span",F,"已付款")):(d(),o("span",q,"未付款"))])])]),t("td",null,[t("div",G,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:r=>i.openModel("edit",s)}," 檢視 ",8,H),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:r=>i.openModel("del",s)}," 刪除 ",8,j)])])]))),128))])]),g(M,{pages:e.pagination,onEmitPages:i.getOrders},null,8,["pages","onEmitPages"])]),t("div",z,[t("div",W,[t("div",J,[K,t("div",Q,[t("div",X,[t("div",Y,[Z,t("table",$,[e.tempOrder.user?(d(),o("tbody",tt,[t("tr",null,[et,t("td",null,l(e.tempOrder.user.name),1)]),t("tr",null,[st,t("td",null,l(e.tempOrder.user.email),1)]),t("tr",null,[lt,t("td",null,l(e.tempOrder.user.tel),1)]),t("tr",null,[ot,t("td",null,l(e.tempOrder.user.address),1)])])):P("",!0)])]),t("div",dt,[nt,t("table",at,[t("tbody",null,[t("tr",null,[it,t("td",null,l(e.tempOrder.id),1)]),t("tr",null,[rt,t("td",null,l(i.createDate(e.tempOrder.create_at)),1)]),t("tr",null,[ct,t("td",null,[e.tempOrder.paid_date?(d(),o("span",_t,l(i.createDate(e.tempOrder.paid_date)),1)):(d(),o("span",ht,"時間不正確"))])]),t("tr",null,[ut,t("td",null,[e.tempOrder.is_paid?(d(),o("strong",pt,"已付款")):(d(),o("span",mt,"尚未付款"))])]),t("tr",null,[bt,t("td",null,l(i.currency(e.tempOrder.total)),1)])])]),ft,t("table",gt,[yt,t("tbody",null,[(d(!0),o(_,null,u(e.tempOrder.products,s=>(d(),o("tr",{key:s.id},[t("th",null,l(s.product.title),1),t("td",null,l(s.qty)+" / "+l(s.product.unit),1),t("td",kt,l(i.currency(s.final_total)),1)]))),128))])]),t("div",vt,[t("div",Ot,[y(t("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":a[0]||(a[0]=s=>e.tempOrder.is_paid=s)},null,512),[[k,e.tempOrder.is_paid]]),t("label",xt,[e.tempOrder.is_paid?(d(),o("span",wt,"已付款")):(d(),o("span",Mt,"未付款"))])])])])])]),Ct])])],512),t("div",Dt,[t("div",Lt,[t("div",Pt,[Et,t("div",Vt,[v(" 是否刪除訂單編號 "),t("strong",Tt,l(e.tempOrder.id),1),v(" (刪除後將無法恢復)。 ")]),t("div",It,[Ut,t("button",{type:"button",class:"btn btn-danger",onClick:a[1]||(a[1]=(...s)=>i.delOrder&&i.delOrder(...s))}," 確認刪除 ")])])])],512)],64)}const Ft=D(V,[["render",St]]);export{Ft as default};
